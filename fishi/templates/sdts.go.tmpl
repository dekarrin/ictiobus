package {{ .FrontendPackage }}

/*
File automatically generated by the ictiobus compiler. DO NOT EDIT. This was
created by invoking ictiobus with the following command:

    {{ .Command }} {{ .CommandArgs }}
*/

import (
	"github.com/dekarrin/ictiobus"
	"github.com/dekarrin/ictiobus/trans"
    
    "strings"
    "fmt"
)

// SDTS returns the generated ictiobus syntax-directed translation scheme for
// {{ .Lang }}.
func SDTS() trans.SDTS {
    sdts := ictiobus.NewSDTS()
{{ range .Bindings }}
    sdtsBind{{ .Head | upperCamel }}(sdts)
{{- end }}

    return sdts
}

{{ range .Bindings }}
func sdtsBind{{ .Head | upperCamel }}(sdts trans.SDTS) {
    var err error
{{- $head := .Head -}}
{{ range .Productions }}
{{- if .Synthetic }}
    err = sdts.Bind(
{{- else }}
    err = sdts.BindI(
{{- end }}
        "{{ $head }}", []string{ {{- range .Symbols }}"{{ . }}", {{- end -}} },
        "{{ .Attribute }}",
        "{{ .Hook }}",
{{- if .Args }}
        []trans.AttrRef{
{{ range .Args -}}
{{ "            " }}{Rel: trans.NodeRelation{Type: trans.{{ .RelType }}, Index: {{ .RelIndex -}} }, Name: "{{ .Attribute }}"},
{{ end -}}
{{ "        " -}} },
{{- else }}
        nil,
{{ end -}}
{{ if not .Synthetic }}
        trans.NodeRelation{Type: trans.{{ .ForRelType }}, Index: {{ .ForRelIndex }} },
{{ end }}
    )
    if err != nil {
        prodStr := strings.Join([]string{ {{- range .Symbols }}"{{ . }}", {{- end -}} }, " ")
        panic(fmt.Sprintf("binding %s -> [%s]: %s", {{ $head | quote }}, prodStr, err.Error()))
    }
{{ end -}}
}
{{ end }}